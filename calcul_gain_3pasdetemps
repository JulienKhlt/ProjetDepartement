include("calcul_gain.jl")
include("proba.jl")
include("tools.jl")

nbre_pas_tps = 3

function calcul_capa_restante(Capa, Itineraires, temps, demande_per)
    n = length(Capa)
    itin = lecture_itin(Itineraires, Capa, temps)[2]
    for i = 1:n
        itin_act = itin[i]
        for j in itin_act
            Capa[i][4] = string(Int(round(parse(Float64,Capa[i][4])-demande_per[j])))
        end
    end
    return Capa
end


function gain_total(proba, prix)
    gain_tot = 0.
    (Itineraires, Demande, Capacites) = initialisation("Itineraire_escales_prix_temps.csv", "DemandeT0.csv", "Capacites2.csv")
    for i = 1:nbre_pas_tps
        Demande = parser_import("DemandeT"*string(i-1)*".csv")
        proba_actuelle = proba[i]
        demande_per = gestion_cap(Itineraires, Demande, Capacites, proba_actuelle, i)
        Capacites = calcul_capa_restante(Capacites, Itineraires, i, demande_per)
        gain_tot += gain(Itineraires, Demande, Capacites, proba_actuelle, prix[i], i)
    end
    return gain_tot
end
